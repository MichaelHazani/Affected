"use strict";function init(){scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.01,800),scene.add(camera),camera.position.set(0,0,50);var e=new THREE.HemisphereLight(16777215,65280,.6);e.position.set(0,10,0),scene.add(e);var n=new THREE.PointLight(65280,1);n.position.set(0,300,200),scene.add(n);var a=new THREE.SphereGeometry(20,20,10),o=new THREE.MeshPhongMaterial({color:16711935,wireframe:!0});sphere=new THREE.Mesh(a,o),sphere.position.set(0,0,0),scene.add(sphere),renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),renderer.setSize(window.innerWidth,window.innerHeight),document.getElementById("threeDiv").appendChild(renderer.domElement),window.addEventListener("resize",function(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)},!1)}function render(){requestAnimationFrame(render),renderer.render(scene,camera),sphere.rotation.y+=.006,"undefined"!=typeof data&&0!==data&&(sphere.scale.z=data[5]/70,sphere.scale.x=data[5]/70,sphere.scale.y=data[5]/70)}var scene,camera,renderer,cube,hemilight,sphere,pyramid,box,audioCtx=new window.AudioContext,soundBuffer,musicSource,array,playing=!1,liveSoundPlaying=!1,musicUrl="audio/piano_sample.ogg",conUrl="audio/IR/EMT 28 Echo Plate.wav",convolver,proc,gainNode,audioInput,analyserNode,bufferLength,dataArray,startOffset=0,data;$(function(){function e(){var e=new XMLHttpRequest;e.open("GET",musicUrl,!0),e.responseType="arraybuffer",e.onload=function(){var a=e.response;n(a)},e.send()}function n(e){musicSource=audioCtx.createBufferSource(),musicSource.loop=!0,audioCtx.decodeAudioData(e,function(e){musicSource.buffer=e,convolver=audioCtx.createConvolver(),gainNode=audioCtx.createGain(),analyserNode=audioCtx.createAnalyser(),proc=audioCtx.createScriptProcessor(1024,1,1),musicSource.connect(convolver),musicSource.connect(gainNode),musicSource.connect(analyserNode),analyserNode.connect(proc),proc.connect(convolver),convolver.connect(gainNode),gainNode.connect(audioCtx.destination),i(conUrl,convolver,o)})}function a(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({audio:!0,video:!1},function(e){audioInput=audioCtx.createMediaStreamSource(e);var n=audioCtx.createConvolver();gainNode=audioCtx.createGain(),analyserNode=audioCtx.createAnalyser(),proc=audioCtx.createScriptProcessor(1024,1,1),audioInput.connect(n),audioInput.connect(gainNode),audioInput.connect(analyserNode),analyserNode.connect(proc),proc.connect(n),n.connect(gainNode),gainNode.connect(audioCtx.destination),i(conUrl,n),data=new Uint8Array(analyserNode.frequencyBinCount),proc.onaudioprocess=function(){analyserNode.getByteFrequencyData(data)}},function(e){alert("Error capturing audio.")})}function o(){musicSource.start(0,startOffset),data=new Uint8Array(analyserNode.frequencyBinCount),proc.onaudioprocess=function(){analyserNode.getByteFrequencyData(data)}}function t(){musicSource.stop(),startOffset+=audioCtx.currentTime}function i(e,n,a){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(){audioCtx.decodeAudioData(o.response,function(e){n.buffer=e,a()})},o.send()}$(".button").click(function(n){"Microphone"!==n.target.innerText||liveSoundPlaying?"Microphone"===n.target.innerText&&liveSoundPlaying?($(this).removeClass("switched"),liveSoundPlaying=!1,audioInput.disconnect()):"Chopin"!==n.target.innerText||playing?"Chopin"===n.target.innerText&&playing?($(this).removeClass("switched"),playing=!1,t()):"Softer"===n.target.innerText&&gainNode.gain.value>=0?($(".volnum").text(gainNode.gain.value.toFixed(1)),gainNode.gain.value-=.1):"Louder"===n.target.innerText&&gainNode.gain.value<=10&&(gainNode.gain.value+=.1,$(".volnum").text(gainNode.gain.value.toFixed(1))):($(this).addClass("switched"),console.log("start playing"),playing=!0,e(),$(".volnum").text(1)):($(this).addClass("switched"),liveSoundPlaying=!0,a())}),$("#subIR").submit(function(n){n.preventDefault(),conUrl="audio/IR/"+$('select[name="IRs"] option:selected').val(),console.log(conUrl),$("select[name='IRs']").blur(),liveSoundPlaying?(audioInput.disconnect(),a()):playing&&(t(),e())}),init(),render()});
