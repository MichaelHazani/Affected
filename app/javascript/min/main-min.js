"use strict";function init(){scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,2e3),scene.add(camera);var e=new THREE.HemisphereLight(16777215,65280,.6);e.position.set(0,10,0),scene.add(e);var n=new THREE.PointLight(65280,1);n.position.set(0,300,200),scene.add(n);var o=new THREE.BoxGeometry(4,4,4),a=new THREE.MeshPhongMaterial({color:16777215}),t=new THREE.Mesh(o,a);scene.add(t),camera.lookAt(t),camera.position.z=-30;var i=new THREE.SphereGeometry(10,10,10),r=new THREE.MeshBasicMaterial({color:16711935}),c=new THREE.Mesh(i,r);scene.add(c),renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1}),renderer.setSize(window.innerWidth,window.innerHeight),document.getElementById("threeDiv").appendChild(renderer.domElement)}function render(){requestAnimationFrame(render),renderer.render(scene,camera)}var scene,renderer,camera,box,audioCtx=new window.AudioContext,soundBuffer,musicSource,array,playing=!1,liveSoundPlaying=!1,musicUrl="audio/piano_sample.ogg",conUrl="audio/IR/EMT 28 Echo Plate.wav",convolver,proc,gainNode,audioInput,analyserNode,bufferLength,dataArray,startOffset=0,data;$(function(){function e(){var e=new XMLHttpRequest;e.open("GET",musicUrl,!0),e.responseType="arraybuffer",e.onload=function(){var o=e.response;n(o)},e.send()}function n(e){musicSource=audioCtx.createBufferSource(),musicSource.loop=!0,audioCtx.decodeAudioData(e,function(e){musicSource.buffer=e,convolver=audioCtx.createConvolver(),gainNode=audioCtx.createGain(),analyserNode=audioCtx.createAnalyser(),proc=audioCtx.createScriptProcessor(1024,1,1),musicSource.connect(analyserNode),analyserNode.connect(proc),proc.connect(convolver),convolver.connect(gainNode),gainNode.connect(audioCtx.destination),i(conUrl,convolver,a)})}function o(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({audio:!0,video:!1},function(e){audioInput=audioCtx.createMediaStreamSource(e);var n=audioCtx.createConvolver();audioInput.connect(n),n.connect(audioCtx.destination),i(conUrl,n)},function(e){alert("Error capturing audio.")})}function a(){musicSource.start(0,startOffset),data=new Uint8Array(analyserNode.frequencyBinCount),proc.onaudioprocess=function(){analyserNode.getByteFrequencyData(data),console.log(data[5])}}function t(){musicSource.stop(),startOffset+=audioCtx.currentTime}function i(e,n,o){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onload=function(){audioCtx.decodeAudioData(a.response,function(e){n.buffer=e,o()})},a.send()}$(document).keypress(function(e){61==e.charCode?(gainNode.gain.value+=.1,console.log(e.charCode)):45==e.charCode&&(gainNode.gain.value-=.1)}),$(".inToggle").click(function(n){console.log(n.target.innerText),"Live Input"!==n.target.innerText||liveSoundPlaying?"Live Input"===n.target.innerText&&liveSoundPlaying?($(this).removeClass("switched"),liveSoundPlaying=!1,audioInput.disconnect()):"Short Clip"!==n.target.innerText||playing?"Short Clip"===n.target.innerText&&playing?($(this).removeClass("switched"),playing=!1,t()):"-"===n.target.innerText?gainNode.gain.value-=.1:"+"===n.target.innerText&&(gainNode.gain.value+=.1):($(this).addClass("switched"),playing=!0,e()):($(this).addClass("switched"),liveSoundPlaying=!0,o())}),$("#subIR").submit(function(n){n.preventDefault(),conUrl="audio/IR/"+$('select[name="IRs"] option:selected').val(),console.log(conUrl),$("select[name='IRs']").blur(),liveSoundPlaying?(audioInput.disconnect(),o()):playing&&(t(),e())}),init(),render()});