"use strict";function init(){scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),scene.add(camera),camera.position.z=50;var a=new THREE.HemisphereLight(16777215,65280,.6);a.position.set(0,10,0),scene.add(a);var b=new THREE.PointLight(65280,1);b.position.set(0,300,200),scene.add(b);var c=new THREE.BoxGeometry(4,4,4),d=new THREE.MeshPhongMaterial({color:16711808,transparent:!1,opacity:1});cube=new THREE.Mesh(c,d),cube.position.set(13,20,0),scene.add(cube);var e=new THREE.SphereGeometry(3,100,10),f=new THREE.MeshPhongMaterial({color:16711808});sphere=new THREE.Mesh(e,f),sphere.position.set(-13,20,0),scene.add(sphere),renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),renderer.setSize(window.innerWidth,window.innerHeight),document.getElementById("threeDiv").appendChild(renderer.domElement)}function render(){requestAnimationFrame(render),renderer.render(scene,camera),cube.rotation.y+=.01,sphere.rotation.y-=.01,"undefined"!=typeof data&&0!==data&&(cube.scale.y=data[5]/70,sphere.scale.y=data[5]/70)}var scene,camera,renderer,cube,hemilight,sphere,box,audioCtx=new window.AudioContext,soundBuffer,musicSource,array,playing=!1,liveSoundPlaying=!1,musicUrl="audio/piano_sample.ogg",conUrl="audio/IR/EMT 28 Echo Plate.wav",convolver,proc,gainNode,audioInput,analyserNode,bufferLength,dataArray,startOffset=0,data;$(function(){function a(){var a=new XMLHttpRequest;a.open("GET",musicUrl,!0),a.responseType="arraybuffer",a.onload=function(){var c=a.response;b(c)},a.send()}function b(a){musicSource=audioCtx.createBufferSource(),musicSource.loop=!0,audioCtx.decodeAudioData(a,function(a){musicSource.buffer=a,convolver=audioCtx.createConvolver(),gainNode=audioCtx.createGain(),analyserNode=audioCtx.createAnalyser(),proc=audioCtx.createScriptProcessor(1024,1,1),musicSource.connect(convolver),musicSource.connect(gainNode),musicSource.connect(analyserNode),analyserNode.connect(proc),proc.connect(convolver),convolver.connect(gainNode),gainNode.connect(audioCtx.destination),f(conUrl,convolver,d)})}function c(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({audio:!0,video:!1},function(a){audioInput=audioCtx.createMediaStreamSource(a);var b=audioCtx.createConvolver();gainNode=audioCtx.createGain(),analyserNode=audioCtx.createAnalyser(),proc=audioCtx.createScriptProcessor(1024,1,1),audioInput.connect(b),audioInput.connect(gainNode),audioInput.connect(analyserNode),analyserNode.connect(proc),proc.connect(b),b.connect(gainNode),gainNode.connect(audioCtx.destination),f(conUrl,b),data=new Uint8Array(analyserNode.frequencyBinCount),proc.onaudioprocess=function(){analyserNode.getByteFrequencyData(data)}},function(a){alert("Error capturing audio.")})}function d(){musicSource.start(0,startOffset),data=new Uint8Array(analyserNode.frequencyBinCount),proc.onaudioprocess=function(){analyserNode.getByteFrequencyData(data)}}function e(){musicSource.stop(),startOffset+=audioCtx.currentTime}function f(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="arraybuffer",d.onload=function(){audioCtx.decodeAudioData(d.response,function(a){b.buffer=a,c()})},d.send()}$(".inToggle").click(function(b){console.log(b.target.innerText),"Live Input"!==b.target.innerText||liveSoundPlaying?"Live Input"===b.target.innerText&&liveSoundPlaying?($(this).removeClass("switched"),liveSoundPlaying=!1,audioInput.disconnect()):"Short Clip"!==b.target.innerText||playing?"Short Clip"===b.target.innerText&&playing?($(this).removeClass("switched"),playing=!1,e()):"-"===b.target.innerText?gainNode.gain.value-=.1:"+"===b.target.innerText&&(gainNode.gain.value+=.1):($(this).addClass("switched"),playing=!0,a()):($(this).addClass("switched"),liveSoundPlaying=!0,c())}),$("#subIR").submit(function(b){b.preventDefault(),conUrl="audio/IR/"+$('select[name="IRs"] option:selected').val(),console.log(conUrl),$("select[name='IRs']").blur(),liveSoundPlaying?(audioInput.disconnect(),c()):playing&&(e(),a())}),init(),render()});var i=1;
