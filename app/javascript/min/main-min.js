"use strict";function init(){scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,80),scene.add(camera),camera.position.set(0,0,50);var e=new THREE.HemisphereLight(16777215,65280,.6);e.position.set(0,10,0),scene.add(e);var n=new THREE.PointLight(65280,1);n.position.set(0,300,200),scene.add(n),window.addEventListener("resize",function(){renderer.setSize(window.innerWidth,window.innerHeight),camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix()});var a=new THREE.BoxGeometry(15,15,15),o=new THREE.MeshPhongMaterial({color:16711935,wireframe:!0,opacity:1});cube=new THREE.Mesh(a,o),cube.position.set(40,0,0),scene.add(cube);var t=new THREE.IcosahedronGeometry(13,2),r=new THREE.MeshPhongMaterial({color:16711935,wireframe:!0});pyramid=new THREE.Mesh(t,r),pyramid.position.set(-40,0,0),scene.add(pyramid);var i=new THREE.SphereGeometry(13,10,10),c=new THREE.MeshPhongMaterial({color:16711935,wireframe:!0});sphere=new THREE.Mesh(i,c),sphere.position.set(0,0,0),scene.add(sphere),renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),renderer.setSize(window.innerWidth,window.innerHeight),document.getElementById("threeDiv").appendChild(renderer.domElement)}function render(){requestAnimationFrame(render),renderer.render(scene,camera),cube.rotation.y+=.01,sphere.rotation.y+=.01,pyramid.rotation.y+=.01,"undefined"!=typeof data&&0!==data&&(cube.scale.y=data[5]/70,sphere.scale.y=data[5]/70)}var scene,camera,renderer,cube,hemilight,sphere,pyramid,box,audioCtx=new window.AudioContext,soundBuffer,musicSource,array,playing=!1,liveSoundPlaying=!1,musicUrl="audio/piano_sample.ogg",conUrl="audio/IR/EMT 28 Echo Plate.wav",convolver,proc,gainNode,audioInput,analyserNode,bufferLength,dataArray,startOffset=0,data;$(function(){function e(){var e=new XMLHttpRequest;e.open("GET",musicUrl,!0),e.responseType="arraybuffer",e.onload=function(){var a=e.response;n(a)},e.send()}function n(e){musicSource=audioCtx.createBufferSource(),musicSource.loop=!0,audioCtx.decodeAudioData(e,function(e){musicSource.buffer=e,convolver=audioCtx.createConvolver(),gainNode=audioCtx.createGain(),analyserNode=audioCtx.createAnalyser(),proc=audioCtx.createScriptProcessor(1024,1,1),musicSource.connect(convolver),musicSource.connect(gainNode),musicSource.connect(analyserNode),analyserNode.connect(proc),proc.connect(convolver),convolver.connect(gainNode),gainNode.connect(audioCtx.destination),r(conUrl,convolver,o)})}function a(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({audio:!0,video:!1},function(e){audioInput=audioCtx.createMediaStreamSource(e);var n=audioCtx.createConvolver();gainNode=audioCtx.createGain(),analyserNode=audioCtx.createAnalyser(),proc=audioCtx.createScriptProcessor(1024,1,1),audioInput.connect(n),audioInput.connect(gainNode),audioInput.connect(analyserNode),analyserNode.connect(proc),proc.connect(n),n.connect(gainNode),gainNode.connect(audioCtx.destination),r(conUrl,n),data=new Uint8Array(analyserNode.frequencyBinCount),proc.onaudioprocess=function(){analyserNode.getByteFrequencyData(data)}},function(e){alert("Error capturing audio.")})}function o(){musicSource.start(0,startOffset),data=new Uint8Array(analyserNode.frequencyBinCount),proc.onaudioprocess=function(){analyserNode.getByteFrequencyData(data)}}function t(){musicSource.stop(),startOffset+=audioCtx.currentTime}function r(e,n,a){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(){audioCtx.decodeAudioData(o.response,function(e){n.buffer=e,a()})},o.send()}$(".button").click(function(n){"Live Input"!==n.target.innerText||liveSoundPlaying?"Live Input"===n.target.innerText&&liveSoundPlaying?($(this).removeClass("switched"),liveSoundPlaying=!1,audioInput.disconnect()):"Short Clip"!==n.target.innerText||playing?"Short Clip"===n.target.innerText&&playing?($(this).removeClass("switched"),playing=!1,t()):"-"===n.target.innerText?gainNode.gain.value-=.1:"+"===n.target.innerText&&(gainNode.gain.value+=.1):($(this).addClass("switched"),playing=!0,e()):($(this).addClass("switched"),liveSoundPlaying=!0,a())}),$("#subIR").submit(function(n){n.preventDefault(),conUrl="audio/IR/"+$('select[name="IRs"] option:selected').val(),console.log(conUrl),$("select[name='IRs']").blur(),liveSoundPlaying?(audioInput.disconnect(),a()):playing&&(t(),e())}),init(),render()});var i=1;
